<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for api_db/tests/hotel-test.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\index.html">All files</a> / <a href="index.html">api_db/tests</a> hotel-test.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>69/69</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>9/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>63/63</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict'
&nbsp;
const test = require('ava')
const sinon = require('sinon')
const proxyquire = require('proxyquire')
&nbsp;
const hotelFixtures = require('./fixtures/hotel')
&nbsp;
let config = {
  logging: function () {}
}
&nbsp;
let single = Object.assign({}, hotelFixtures.single)
let id = 1
let idArgs = {
  where: { id: 1 }
}
let nameArgs = {
  where: { name: 'hotel' }
}
let newHotel = {
  name: 'new Hotel',
  stars: 5,
  price: '555.5555',
  image: 'new-image.png',
  amenities: ['new']
}
let name = 'hotel'
let HotelStub = null
let db = null
let sandbox = null
&nbsp;
test.beforeEach(async () =&gt; {
  sandbox = sinon.sandbox.create()
&nbsp;
  HotelStub = {}
&nbsp;
    // Model create Stub
  HotelStub.create = sandbox.stub()
  HotelStub.create.withArgs(newHotel).returns(Promise.resolve({ toJSON () { return newHotel } }))
&nbsp;
    // Model update Stub
  HotelStub.update = sandbox.stub()
  HotelStub.update.withArgs(single, idArgs).returns(Promise.resolve(single))
&nbsp;
    // Model findOne Stub
  HotelStub.findOne = sandbox.stub()
  HotelStub.findOne.withArgs(idArgs).returns(Promise.resolve(hotelFixtures.findById(id)))
&nbsp;
    // Model findById Stub
  HotelStub.findById = sandbox.stub()
  HotelStub.findById.withArgs(id).returns(Promise.resolve(hotelFixtures.findById(id)))
&nbsp;
    // Model findAll Stub
  HotelStub.findAll = sandbox.stub()
  HotelStub.findAll.withArgs().returns(Promise.resolve(hotelFixtures.all))
  HotelStub.findAll.withArgs(nameArgs).returns(Promise.resolve(hotelFixtures.h))
&nbsp;
  const setupDB = proxyquire('../', {
    './models/hotel': () =&gt; HotelStub
  })
  db = await setupDB(config)
})
&nbsp;
test.afterEach(() =&gt; {
  sandbox &amp;&amp; sinon.sandbox.restore()
})
&nbsp;
test('Hotel', t =&gt; {
  t.truthy(db.Hotel, 'Hotel service should exist')
})
&nbsp;
test.serial('Hotel#findById', async t =&gt; {
  let hotel = await db.Hotel.findById(id)
&nbsp;
  t.true(HotelStub.findById.called, 'findById should be called on model')
  t.true(HotelStub.findById.calledOnce, 'findById should be called once')
  t.true(HotelStub.findById.calledWith(id), 'findById should be called with specified id')
&nbsp;
  t.deepEqual(hotel, hotelFixtures.findById(id), 'should be the same')
})
&nbsp;
test.serial('Hotel#createOrUpdate - exists', async t =&gt; {
  let hotel = await db.Hotel.createOrUpdate(single)
&nbsp;
  t.true(HotelStub.findOne.called, 'findOne should be called on model')
  t.true(HotelStub.findOne.calledTwice, 'findOne should be called twice')
  t.true(HotelStub.update.calledOnce, 'update should be called once')
&nbsp;
  t.deepEqual(hotel, single, 'hotel should be the same')
})
&nbsp;
test.serial('Hotel#createOrUpdate - new', async t =&gt; {
  let hotel = await db.Hotel.createOrUpdate(newHotel)
&nbsp;
  t.true(HotelStub.findOne.called, 'findOne should be called on model')
  t.true(HotelStub.findOne.calledOnce, 'findOne should be called once')
  t.true(HotelStub.findOne.calledWith({
    where: { id: newHotel.id }
  }), 'findOne should be called with id args')
  t.true(HotelStub.create.called, 'create should be called on model')
  t.true(HotelStub.create.calledOnce, 'create should be called once')
  t.true(HotelStub.create.calledWith(newHotel), 'create should be called with model')
&nbsp;
  t.deepEqual(hotel, newHotel, 'hotel should be the same')
})
&nbsp;
test.serial('Hotel#findAll', async t =&gt; {
  let hotels = await db.Hotel.findAll()
&nbsp;
  t.true(HotelStub.findAll.called, 'findAll should be called on model')
  t.true(HotelStub.findAll.calledOnce, 'findAll should be called once')
  t.true(HotelStub.findAll.calledWith(), 'findAll should be called without Args')
&nbsp;
  t.is(hotels.length, hotelFixtures.all.length, 'hotels should be the same')
  t.deepEqual(hotels, hotelFixtures.all, 'hotels should be the same')
})
&nbsp;
// test.serial('Setup', t =&gt; {
//     t.true(HotelStub, 'Hotel was executed')
// })
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Tue Jan 23 2018 23:30:14 GMT-0500 (Hora est. Pacífico, Sudamérica)
</div>
</div>
<script src="..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\sorter.js"></script>
</body>
</html>
